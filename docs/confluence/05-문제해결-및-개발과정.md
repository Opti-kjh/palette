# Palette MCP Server - ë¬¸ì œ í•´ê²° ë° ê°œë°œ ê³¼ì •

> ì´ ë¬¸ì„œëŠ” MCP ì„œë²„ ê°œë°œ ê³¼ì •ì—ì„œ ë§ˆì£¼ì¹œ í•µì‹¬ ë¬¸ì œë“¤ê³¼ ê·¸ í•´ê²° ë°©ë²•ì„ ìƒì„¸íˆ ê¸°ìˆ í•©ë‹ˆë‹¤.
> í–¥í›„ MCP ê°œë°œì˜ êµë³¸ ë° ì°¸ê³  ìë£Œë¡œ í™œìš©ë©ë‹ˆë‹¤.

---

## ëª©ì°¨

1. [ì™¸ë¶€ íŒ¨í‚¤ì§€ ì»´í¬ë„ŒíŠ¸ ë©”íƒ€ë°ì´í„° ë™ê¸°í™”](#1-ì™¸ë¶€-íŒ¨í‚¤ì§€-ì»´í¬ë„ŒíŠ¸-ë©”íƒ€ë°ì´í„°-ë™ê¸°í™”)
2. [TypeScript AST ë¶„ì„ì„ í†µí•œ Props ì¶”ì¶œ](#2-typescript-ast-ë¶„ì„ì„-í†µí•œ-props-ì¶”ì¶œ)
3. [MCP-First + REST API í´ë°± íŒ¨í„´](#3-mcp-first--rest-api-í´ë°±-íŒ¨í„´)
4. [Local/Remote ì‹¤í–‰ ëª¨ë“œ ë¶„ë¦¬](#4-localremote-ì‹¤í–‰-ëª¨ë“œ-ë¶„ë¦¬)
5. [Figma ë…¸ë“œ â†’ ë””ìì¸ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸ ë§¤í•‘](#5-figma-ë…¸ë“œ--ë””ìì¸-ì‹œìŠ¤í…œ-ì»´í¬ë„ŒíŠ¸-ë§¤í•‘)
6. [ìºì‹œ ê¸°ë°˜ ì„±ëŠ¥ ìµœì í™”](#6-ìºì‹œ-ê¸°ë°˜-ì„±ëŠ¥-ìµœì í™”)

---

## 1. ì™¸ë¶€ íŒ¨í‚¤ì§€ ì»´í¬ë„ŒíŠ¸ ë©”íƒ€ë°ì´í„° ë™ê¸°í™”

### ë¬¸ì œ ìƒí™©

Palette MCP ì„œë²„ëŠ” `@dealicious/design-system-react`ì™€ `@dealicious/design-system` íŒ¨í‚¤ì§€ì˜ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì½”ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ íŒ¨í‚¤ì§€ë“¤ì€:

- **ë¹„ê³µê°œ npm íŒ¨í‚¤ì§€**ë¡œ ì§ì ‘ ì˜ì¡´ì„± ì¶”ê°€ ë¶ˆê°€
- **ë³„ë„ì˜ GitHub ì €ì¥ì†Œ(`ssm-web`)**ì—ì„œ ê´€ë¦¬ë¨
- ì»´í¬ë„ŒíŠ¸ **ë©”íƒ€ë°ì´í„°(props, íƒ€ì… ë“±)ê°€ ìˆ˜ì‹œë¡œ ë³€ê²½**ë¨

**í•µì‹¬ ì§ˆë¬¸**: ì™¸ë¶€ ì €ì¥ì†Œì— ìˆëŠ” ì»´í¬ë„ŒíŠ¸ ì •ë³´ë¥¼ ì–´ë–»ê²Œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë™ê¸°í™”í•  ê²ƒì¸ê°€?

### í•´ê²° ë°©ë²•: GitHub API + TypeScript AST ë¶„ì„

#### ì•„í‚¤í…ì²˜ ì„¤ê³„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ComponentSyncService                         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ GitHubClientâ”‚â”€â”€â–¶â”‚TypeScriptAnalyzerâ”‚â”€â”€â–¶â”‚  CacheManager   â”‚   â”‚
â”‚  â”‚             â”‚   â”‚                  â”‚   â”‚                 â”‚   â”‚
â”‚  â”‚ - API í˜¸ì¶œ   â”‚   â”‚ - AST íŒŒì‹±         â”‚   â”‚ - íŒŒì¼ ìºì‹œ       â”‚   â”‚
â”‚  â”‚ - íŒŒì¼ ê°€ì ¸ì˜¤ê¸° â”‚   â”‚ - Props ì¶”ì¶œ      â”‚   â”‚ - ì»¤ë°‹ SHA ê²€ì¦   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### êµ¬í˜„ ì½”ë“œ í•µì‹¬

**1ë‹¨ê³„: GitHubì—ì„œ ì»´í¬ë„ŒíŠ¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°**

```typescript
// src/sync/github-client.ts
export class GitHubClient {
  private octokit: Octokit;

  constructor(config: Partial<GitHubConfig> = {}) {
    this.config = {
      owner: 'dealicious-inc',
      repo: 'ssm-web',
      ...config
    };
    this.octokit = new Octokit({ auth: process.env.GITHUB_TOKEN });
  }

  // React ì»´í¬ë„ŒíŠ¸ ëª©ë¡: packages/design-system-react/src/components/
  async getReactComponentList(ref?: string): Promise<string[]> {
    const basePath = 'packages/design-system-react/src/components';
    return this.listFiles(basePath, ref);  // ['ssm-button', 'ssm-input', ...]
  }

  // ì»´í¬ë„ŒíŠ¸ ì†ŒìŠ¤ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
  async getReactComponentSource(componentDir: string, ref?: string): Promise<FileContent | null> {
    const basePath = `packages/design-system-react/src/components/${componentDir}`;

    // ì—¬ëŸ¬ ê°€ëŠ¥í•œ íŒŒì¼ëª… ì‹œë„ (í”„ë¡œì íŠ¸ë§ˆë‹¤ ì»¨ë²¤ì…˜ì´ ë‹¤ë¦„)
    const mainFiles = [
      `${basePath}/${componentDir}.tsx`,      // ssm-button/ssm-button.tsx
      `${basePath}/index.tsx`,                 // ssm-button/index.tsx
      `${basePath}/${this.toPascalCase(componentDir)}.tsx`,  // ssm-button/SsmButton.tsx
    ];

    // Propsê°€ ë³„ë„ íŒŒì¼ì— ìˆì„ ìˆ˜ ìˆìŒ
    const auxiliaryFiles = [
      `${basePath}/types.ts`,                  // ssm-icon/types.ts
      `${basePath}/base/${simpleComponentName}.tsx`,  // ssm-accordion/base/accordion.tsx
    ];

    // ë©”ì¸ íŒŒì¼ + ë³´ì¡° íŒŒì¼ ë³‘í•©í•˜ì—¬ ë°˜í™˜
    // ...
  }
}
```

**2ë‹¨ê³„: TypeScript Compiler APIë¡œ ì†ŒìŠ¤ ì½”ë“œ ë¶„ì„**

```typescript
// src/sync/typescript-analyzer.ts
import ts from 'typescript';

export class TypeScriptAnalyzer {
  analyzeReactComponent(sourceCode: string, componentDir: string): AnalyzedComponent | null {
    // TypeScript Compiler APIë¡œ AST ìƒì„±
    const sourceFile = ts.createSourceFile(
      'component.tsx',
      sourceCode,
      ts.ScriptTarget.Latest,
      true,
      ts.ScriptKind.TSX
    );

    // Props ì¸í„°í˜ì´ìŠ¤ ì°¾ê¸° (ë‹¤ì–‘í•œ ë„¤ì´ë° ì»¨ë²¤ì…˜ ì§€ì›)
    const propsInterfaceNames = [
      `${componentName}Props`,        // ButtonProps
      `Ssm${componentName}Props`,     // SsmButtonProps
      `Props`,                         // Props
    ];

    // AST ìˆœíšŒí•˜ë©° Props ì¶”ì¶œ
    const visit = (node: ts.Node) => {
      if (ts.isInterfaceDeclaration(node)) {
        if (propsInterfaceNames.includes(node.name.text)) {
          node.members.forEach((member) => {
            const prop = this.extractPropFromMember(member);
            if (prop) props.push(prop);
          });
        }
      }
      ts.forEachChild(node, visit);
    };

    visit(sourceFile);
    return { name, description, props, examples };
  }
}
```

**3ë‹¨ê³„: ë™ê¸°í™” ì„œë¹„ìŠ¤ í†µí•©**

```typescript
// src/sync/component-sync.ts
export class ComponentSyncService {
  async sync(options: SyncOptions = {}): Promise<SyncResult> {
    // 1. ìµœì‹  ì»¤ë°‹ SHA í™•ì¸
    const commitInfo = await this.githubClient.getLatestCommitSha();

    // 2. ìºì‹œ ìœ íš¨ì„± ê²€ì‚¬ (ê°™ì€ ì»¤ë°‹ì´ë©´ ìºì‹œ ì‚¬ìš©)
    if (!options.force) {
      const isValid = await this.cacheManager.isValid(commitInfo.sha);
      if (isValid) {
        return this.cacheManager.load();  // ìºì‹œì—ì„œ ë°˜í™˜
      }
    }

    // 3. GitHubì—ì„œ ì»´í¬ë„ŒíŠ¸ ë™ê¸°í™”
    const [reactComponents, vueComponents] = await Promise.all([
      this.syncReactComponents(commitInfo.sha),
      this.syncVueComponents(commitInfo.sha),
    ]);

    // 4. ìºì‹œ ì €ì¥
    await this.cacheManager.save(commitInfo.sha, reactComponents, vueComponents);

    return { success: true, reactComponents, vueComponents };
  }
}
```

### í•µì‹¬ êµí›ˆ

| ë¬¸ì œ | í•´ê²°ì±… |
|------|--------|
| npm íŒ¨í‚¤ì§€ ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€ | GitHub REST APIë¡œ ì†ŒìŠ¤ ì½”ë“œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸° |
| ë©”íƒ€ë°ì´í„° ìˆ˜ë™ ê´€ë¦¬ì˜ ì–´ë ¤ì›€ | TypeScript Compiler APIë¡œ ìë™ ì¶”ì¶œ |
| API í˜¸ì¶œ ë¹„ìš©/ì†ë„ | ì»¤ë°‹ SHA ê¸°ë°˜ ìºì‹œë¡œ ë¶ˆí•„ìš”í•œ í˜¸ì¶œ ë°©ì§€ |
| ë‹¤ì–‘í•œ íŒŒì¼ êµ¬ì¡° ëŒ€ì‘ | ì—¬ëŸ¬ íŒŒì¼ëª… íŒ¨í„´ ì‹œë„ + ë³´ì¡° íŒŒì¼ ë³‘í•© |

---

## 2. TypeScript AST ë¶„ì„ì„ í†µí•œ Props ì¶”ì¶œ

### ë¬¸ì œ ìƒí™©

ë””ìì¸ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸ì˜ Props ì •ì˜ëŠ” ë§¤ìš° ë‹¤ì–‘í•œ í˜•íƒœë¡œ ì¡´ì¬í•©ë‹ˆë‹¤:

```typescript
// íŒ¨í„´ 1: ì§ì ‘ interface ì •ì˜
interface SsmButtonProps {
  variant?: 'primary' | 'secondary';
  size?: 'small' | 'medium' | 'large';
}

// íŒ¨í„´ 2: íƒ€ì… ë³„ì¹­ + Union íƒ€ì…
type AccordionProps = BaseProps & {
  title: string;
} | ConditionalProps;

// íŒ¨í„´ 3: ë³„ë„ íŒŒì¼ì— ì •ì˜ (types.ts)
// types.ts
export interface SsmIconProps {
  name: string;
  size?: number;
}

// íŒ¨í„´ 4: Vueì˜ defineProps
const props = defineProps<{
  modelValue?: boolean;
  disabled?: boolean;
}>();

// íŒ¨í„´ 5: withDefaults ë˜í•‘
const props = withDefaults(defineProps<SsmButtonProps>(), {
  variant: 'primary'
});
```

**í•µì‹¬ ì§ˆë¬¸**: ì´ ëª¨ë“  íŒ¨í„´ì„ ì–´ë–»ê²Œ í†µì¼ëœ ë°©ì‹ìœ¼ë¡œ ë¶„ì„í•  ê²ƒì¸ê°€?

### í•´ê²° ë°©ë²•: ì¬ê·€ì  íƒ€ì… ì°¸ì¡° í•´ê²°

```typescript
// src/sync/typescript-analyzer.ts

/**
 * íƒ€ì… ë…¸ë“œì—ì„œ props ì¶”ì¶œ (íƒ€ì… ì°¸ì¡° ì¬ê·€ í•´ê²°)
 */
private extractPropsFromTypeNodeWithRefs(
  typeNode: ts.TypeNode,
  props: ComponentProp[],
  typeDefinitions: Map<string, ts.TypeNode>,
  visited: Set<string> = new Set()  // ìˆœí™˜ ì°¸ì¡° ë°©ì§€
): void {

  // 1. íƒ€ì… ë¦¬í„°ëŸ´: { prop1: string; prop2: number }
  if (ts.isTypeLiteralNode(typeNode)) {
    typeNode.members.forEach((member) => {
      const prop = this.extractPropFromMember(member);
      if (prop) props.push(prop);
    });
    return;
  }

  // 2. Intersection íƒ€ì…: A & B
  if (ts.isIntersectionTypeNode(typeNode)) {
    typeNode.types.forEach((type) => {
      this.extractPropsFromTypeNodeWithRefs(type, props, typeDefinitions, visited);
    });
    return;
  }

  // 3. Union íƒ€ì…: A | B (ê° ë¶„ê¸°ì—ì„œ ê³µí†µ props ì¶”ì¶œ)
  if (ts.isUnionTypeNode(typeNode)) {
    typeNode.types.forEach((type) => {
      this.extractPropsFromTypeNodeWithRefs(type, props, typeDefinitions, visited);
    });
    return;
  }

  // 4. íƒ€ì… ì°¸ì¡°: ConditionalProps ê°™ì€ ë‹¤ë¥¸ íƒ€ì… ì°¸ì¡°
  if (ts.isTypeReferenceNode(typeNode)) {
    const typeName = typeNode.typeName.getText();

    // ìœ í‹¸ë¦¬í‹° íƒ€ì…ì€ ê±´ë„ˆë›°ê¸°
    if (['Omit', 'Pick', 'Partial', 'Required'].includes(typeName)) {
      return;
    }

    // ìˆœí™˜ ì°¸ì¡° ë°©ì§€
    if (visited.has(typeName)) return;
    visited.add(typeName);

    // ê°™ì€ íŒŒì¼ì— ì •ì˜ëœ íƒ€ì… ì¬ê·€ì ìœ¼ë¡œ í•´ê²°
    const referencedType = typeDefinitions.get(typeName);
    if (referencedType) {
      this.extractPropsFromTypeNodeWithRefs(referencedType, props, typeDefinitions, visited);
    }
  }
}
```

### Vue SFC íŠ¹ìˆ˜ ì²˜ë¦¬

```typescript
/**
 * Vue SFCì—ì„œ script ë¸”ë¡ ì¶”ì¶œ
 */
private extractVueScript(sourceCode: string): string | null {
  // <script setup lang="ts"> ... </script> ì¶”ì¶œ
  const scriptRegex = /<script[^>]*(?:setup)?[^>]*>[\s\S]*?<\/script>/gi;
  const matches = sourceCode.match(scriptRegex);

  // setup script ìš°ì„ 
  const setupMatch = matches.find((m) => m.includes('setup'));
  const targetScript = setupMatch || matches[0];

  // íƒœê·¸ ì œê±°í•˜ê³  TypeScript ì½”ë“œë§Œ ë°˜í™˜
  return targetScript
    .replace(/<script[^>]*>/, '')
    .replace(/<\/script>/, '')
    .trim();
}

/**
 * Vue definePropsì—ì„œ props ì¶”ì¶œ
 */
private extractPropsFromVue(sourceFile: ts.SourceFile): ComponentProp[] {
  const visit = (node: ts.Node) => {
    if (ts.isCallExpression(node)) {
      const expression = node.expression;

      // defineProps<{ ... }>() íŒ¨í„´
      if (ts.isIdentifier(expression) && expression.text === 'defineProps') {
        if (node.typeArguments && node.typeArguments.length > 0) {
          const typeArg = node.typeArguments[0];
          // íƒ€ì… ë¦¬í„°ëŸ´ ë˜ëŠ” íƒ€ì… ì°¸ì¡° ì²˜ë¦¬...
        }
      }

      // withDefaults(defineProps<...>(), { ... }) íŒ¨í„´
      if (ts.isIdentifier(expression) && expression.text === 'withDefaults') {
        // defineProps í˜¸ì¶œ ì¶”ì¶œí•˜ì—¬ ì²˜ë¦¬...
      }
    }
    ts.forEachChild(node, visit);
  };
}
```

### í•µì‹¬ êµí›ˆ

| íŒ¨í„´ | í•´ê²° ë°©ë²• |
|------|-----------|
| ë‹¤ì–‘í•œ Props ì •ì˜ ë°©ì‹ | ë‹¤ì¤‘ ì¸í„°í˜ì´ìŠ¤/íƒ€ì… ì´ë¦„ ì‹œë„ |
| ì¤‘ì²©ëœ íƒ€ì… ì°¸ì¡° | ì¬ê·€ì  íƒ€ì… í•´ê²° + visited Setìœ¼ë¡œ ìˆœí™˜ ë°©ì§€ |
| Union/Intersection íƒ€ì… | ê° ë¶„ê¸° ìˆœíšŒí•˜ë©° ëª¨ë“  props ìˆ˜ì§‘ í›„ ì¤‘ë³µ ì œê±° |
| Vue SFC | script ë¸”ë¡ ì¶”ì¶œ í›„ TypeScriptë¡œ íŒŒì‹± |
| ë³„ë„ íŒŒì¼ì˜ íƒ€ì… ì •ì˜ | ì—¬ëŸ¬ íŒŒì¼ ë³‘í•© í›„ ë¶„ì„ |

---

## 3. MCP-First + REST API í´ë°± íŒ¨í„´

### ë¬¸ì œ ìƒí™©

Figma ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë°©ë²•ì´ ë‘ ê°€ì§€ ìˆìŠµë‹ˆë‹¤:

1. **Figma Desktop MCP**: ë¡œì»¬ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ Figma ì•±ì˜ MCP ì„œë²„
   - ì¥ì : ì¸ì¦ ë¶ˆí•„ìš”, ë¹ ë¥¸ ì‘ë‹µ
   - ë‹¨ì : Figma Desktop ì‹¤í–‰ í•„ìš”, Remote í™˜ê²½ì—ì„œ ì‚¬ìš© ë¶ˆê°€

2. **Figma REST API**: ê³µì‹ ì›¹ API
   - ì¥ì : ì–´ë””ì„œë“  ì‚¬ìš© ê°€ëŠ¥
   - ë‹¨ì : Access Token í•„ìš”, Rate Limit ì¡´ì¬

**í•µì‹¬ ì§ˆë¬¸**: ë‘ ë°©ë²•ì„ ì–´ë–»ê²Œ ìš°ì•„í•˜ê²Œ í†µí•©í•  ê²ƒì¸ê°€?

### í•´ê²° ë°©ë²•: í´ë°± ì²´ì¸ íŒ¨í„´

```typescript
// src/services/figma.ts

export class FigmaService {
  private mcpClient: FigmaMCPClient | null = null;
  private useMCP: boolean;

  constructor(useMCP: boolean = true, mcpBaseUrl?: string) {
    this.useMCP = useMCP;

    if (useMCP) {
      const mcpUrl = mcpBaseUrl || process.env.FIGMA_MCP_SERVER_URL || 'http://127.0.0.1:3845/mcp';
      this.mcpClient = new FigmaMCPClient(mcpUrl);
    }
  }

  async getFigmaData(url: string, nodeId?: string): Promise<FigmaFile> {
    const fileId = this.extractFileId(url);

    // 1ì°¨ ì‹œë„: MCP í´ë¼ì´ì–¸íŠ¸
    if (this.useMCP && this.mcpClient !== null) {
      try {
        const isAvailable = await this.mcpClient.isAvailable();
        if (isAvailable) {
          const mcpData = await this.mcpClient.getFileData(fileId, nodeId);
          if (mcpData) {
            return this.transformMCPResponseToFigmaFile(mcpData);
          }
        }
      } catch (error) {
        console.warn('Figma MCP ì„œë²„ ì—°ê²° ì‹¤íŒ¨, REST APIë¡œ í´ë°±:', error);
        // í´ë°±ìœ¼ë¡œ ê³„ì† ì§„í–‰
      }
    }

    // 2ì°¨ ì‹œë„: REST API í´ë°±
    if (!this.accessToken) {
      throw new Error('Figma ì•¡ì„¸ìŠ¤ í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤. MCP ì„œë²„ë„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }

    const response = await axios.get(`${this.baseUrl}/files/${fileId}`, {
      headers: { 'X-Figma-Token': this.accessToken },
      params: { ids: nodeId || undefined },
    });

    return this.transformRestApiResponse(response.data);
  }
}
```

### MCP í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„

```typescript
// src/utils/figma-mcp-client.ts

export class FigmaMCPClient {
  private client: AxiosInstance;

  constructor(baseUrl: string = 'http://127.0.0.1:3845/mcp') {
    this.client = axios.create({
      baseURL: baseUrl,
      timeout: 30000,
      headers: { 'Content-Type': 'application/json' },
    });
  }

  // JSON-RPC 2.0 ìš”ì²­ ìƒì„±
  private createRequest(method: string, params?: any): any {
    return {
      jsonrpc: '2.0',
      id: ++this.requestId,
      method,
      params: params || {},
    };
  }

  async getFileData(fileId: string, nodeId?: string): Promise<any> {
    // 1. ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ ëª©ë¡ í™•ì¸
    const tools = await this.listTools();
    if (!tools || tools.length === 0) return null;

    // 2. íŒŒì¼ ë°ì´í„° ë„êµ¬ ì°¾ê¸° (ë‹¤ì–‘í•œ ì´ë¦„ ì‹œë„)
    const possibleToolNames = [
      'get_file', 'getFile', 'fetch_file',
      'fetchFile', 'get_figma_file', 'figma_get_file',
    ];

    for (const toolName of possibleToolNames) {
      const tool = tools.find((t: any) => t.name === toolName);
      if (tool) {
        const result = await this.callTool(toolName, { fileId, nodeId });
        if (result) return result;
      }
    }

    return null;  // ë„êµ¬ë¥¼ ì°¾ì§€ ëª»í•˜ë©´ null (í´ë°± íŠ¸ë¦¬ê±°)
  }

  // ì—°ê²° ê°€ëŠ¥ ì—¬ë¶€ ë¹ ë¥´ê²Œ í™•ì¸
  async isAvailable(): Promise<boolean> {
    try {
      await this.listTools();
      return true;
    } catch {
      return false;
    }
  }
}
```

### í•µì‹¬ êµí›ˆ

| ì›ì¹™ | ì ìš© |
|------|------|
| ìš°ì•„í•œ ì„±ëŠ¥ ì €í•˜ | MCP ì‹¤íŒ¨ ì‹œ REST APIë¡œ ìë™ í´ë°± |
| ë¹ ë¥¸ ì‹¤íŒ¨ ê°ì§€ | `isAvailable()` ìœ¼ë¡œ ì—°ê²° ìƒíƒœ ì‚¬ì „ í™•ì¸ |
| ìœ ì—°í•œ ë„êµ¬ íƒìƒ‰ | ì—¬ëŸ¬ ë„êµ¬ ì´ë¦„ ì‹œë„ë¡œ ë‹¤ì–‘í•œ MCP ì„œë²„ í˜¸í™˜ |
| ì—ëŸ¬ ë¡œê¹… | í´ë°± ì‹œ ê²½ê³  ë¡œê·¸ë¡œ ë””ë²„ê¹… ì§€ì› |

---

## 4. Local/Remote ì‹¤í–‰ ëª¨ë“œ ë¶„ë¦¬

### ë¬¸ì œ ìƒí™©

Palette MCP ì„œë²„ëŠ” ë‘ ê°€ì§€ í™˜ê²½ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤:

1. **Local ëª¨ë“œ**: ê°œë°œì PCì—ì„œ Cursorì™€ í•¨ê»˜ ì‹¤í–‰
   - stdio transport ì‚¬ìš©
   - Figma Desktop MCP ì ‘ê·¼ ê°€ëŠ¥ (localhost)

2. **Remote ëª¨ë“œ**: Smithery.ai í´ë¼ìš°ë“œì—ì„œ ì‹¤í–‰
   - Smithery SDK transport ì‚¬ìš©
   - localhost ì ‘ê·¼ **ë¶ˆê°€ëŠ¥** (Figma Desktop MCP ì‚¬ìš© ë¶ˆê°€)

**í•µì‹¬ ì§ˆë¬¸**: í•˜ë‚˜ì˜ ì½”ë“œë² ì´ìŠ¤ë¡œ ë‘ í™˜ê²½ì„ ì–´ë–»ê²Œ ì§€ì›í•  ê²ƒì¸ê°€?

### í•´ê²° ë°©ë²•: ê³µí†µ ì„œë²„ ë¡œì§ ë¶„ë¦¬

```
src/
â”œâ”€â”€ server.ts      # ê³µí†µ ë¡œì§ (Tools, Prompts, Resources ì •ì˜)
â”œâ”€â”€ index.ts       # Local ëª¨ë“œ ì§„ì…ì  (stdio transport)
â””â”€â”€ smithery.ts    # Remote ëª¨ë“œ ì§„ì…ì  (Smithery SDK transport)
```

**ê³µí†µ ì„œë²„ ë¡œì§** (`server.ts`):

```typescript
// src/server.ts

export interface ServerConfig {
  figmaAccessToken?: string;
  githubToken?: string;
  figmaMcpServerUrl?: string;
  useFigmaMcp?: boolean;  // Remote ëª¨ë“œì—ì„œëŠ” false
  syncConfig?: SyncConfig;
}

export function createPaletteServer(config: ServerConfig = {}): Server {
  const server = new Server(
    { name: 'palette', version: '1.0.0' },
    { capabilities: { tools: {}, prompts: {}, resources: {} } }
  );

  // ì„œë¹„ìŠ¤ ì´ˆê¸°í™” - useFigmaMcp í”Œë˜ê·¸ë¡œ MCP ì‚¬ìš© ì—¬ë¶€ ì œì–´
  const useFigmaMcp = config.useFigmaMcp !== undefined ? config.useFigmaMcp : true;
  const figmaService = new FigmaService(useFigmaMcp, config.figmaMcpServerUrl);

  // Tools, Prompts, Resources í•¸ë“¤ëŸ¬ ë“±ë¡...

  return server;
}
```

**Local ëª¨ë“œ** (`index.ts`):

```typescript
// src/index.ts
#!/usr/bin/env node

import dotenv from 'dotenv';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import { createPaletteServer } from './server.js';

dotenv.config();

async function main() {
  const server = createPaletteServer({
    figmaAccessToken: process.env.FIGMA_ACCESS_TOKEN,
    githubToken: process.env.GITHUB_TOKEN,
    figmaMcpServerUrl: process.env.FIGMA_MCP_SERVER_URL,
    useFigmaMcp: true,  // Localì—ì„œëŠ” MCP ì‚¬ìš©
  });

  const transport = new StdioServerTransport();
  await server.connect(transport);

  console.error('Palette server running on stdio (Local mode)');
}

main().catch(console.error);
```

**Remote ëª¨ë“œ** (`smithery.ts`):

```typescript
// src/smithery.ts

import { createSmitheryServer } from '@smithery/sdk';
import { createPaletteServer } from './server.js';

export default createSmitheryServer((config) => {
  return createPaletteServer({
    figmaAccessToken: config.figmaAccessToken,
    githubToken: config.githubToken,
    useFigmaMcp: false,  // Remoteì—ì„œëŠ” MCP ë¹„í™œì„±í™” (localhost ì ‘ê·¼ ë¶ˆê°€)
  });
});
```

### í•µì‹¬ êµí›ˆ

| ì›ì¹™ | ì ìš© |
|------|------|
| ë‹¨ì¼ ì±…ì„ ì›ì¹™ | ê³µí†µ ë¡œì§(server.ts)ê³¼ ì§„ì…ì (index.ts, smithery.ts) ë¶„ë¦¬ |
| ì„¤ì • ì£¼ì… | ServerConfigë¡œ í™˜ê²½ë³„ ì„¤ì • ì£¼ì… |
| í™˜ê²½ë³„ ì œì•½ ëŒ€ì‘ | useFigmaMcp í”Œë˜ê·¸ë¡œ ê¸°ëŠ¥ ë¹„í™œì„±í™” |

---

## 5. Figma ë…¸ë“œ â†’ ë””ìì¸ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸ ë§¤í•‘

### ë¬¸ì œ ìƒí™©

Figmaì˜ ë…¸ë“œ êµ¬ì¡°ì™€ ë””ìì¸ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸ëŠ” 1:1 ëŒ€ì‘ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤:

```
Figma ë…¸ë“œ íƒ€ì…      ë””ìì¸ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TEXT                 Text, TextLink
FRAME                div, Tab, Accordion, Modal...
RECTANGLE            Button, Badge, Tag, Input...
COMPONENT            ë‹¤ì–‘í•œ ì»´í¬ë„ŒíŠ¸
```

**í•µì‹¬ ì§ˆë¬¸**: Figma ë…¸ë“œë¥¼ ì–´ë–»ê²Œ ì ì ˆí•œ ë””ìì¸ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸ì— ë§¤í•‘í•  ê²ƒì¸ê°€?

### í•´ê²° ë°©ë²•: ë‹¤ì¸µ ë§¤í•‘ ì „ëµ

```typescript
// src/services/code-generator.ts

/**
 * Figma ë…¸ë“œ ì†ì„±ì— ë”°ë¼ ë””ìì¸ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸ ì°¾ê¸°
 */
private findComponentByNodeProperties(
  node: FigmaNode,
  framework: 'react' | 'vue'
): DesignSystemComponent | null {
  const nodeName = node.name.toLowerCase();
  const nodeType = node.type;

  // 1. ì§ì ‘ ì´ë¦„ ë§¤ì¹­ (ê°€ì¥ ì •í™•)
  let component = this.designSystemService.findBestMatch(nodeName, framework);
  if (component) return component;

  // 2. ë…¸ë“œ íƒ€ì… ê¸°ë°˜ ë§¤ì¹­
  switch (nodeType) {
    case 'TEXT':
      // ë²„íŠ¼ ë ˆì´ë¸”ì¸ì§€ í™•ì¸
      if (this.isButtonLabel(node)) {
        return this.designSystemService.getComponent('Button', framework);
      }
      // ë§í¬ í…ìŠ¤íŠ¸ì¸ì§€ í™•ì¸
      if (nodeName.includes('link') || nodeName.includes('href')) {
        return this.designSystemService.getComponent('TextLink', framework);
      }
      return this.designSystemService.getComponent('Text', framework);

    case 'FRAME':
      return this.analyzeFrameNode(node, framework);

    case 'RECTANGLE':
      if (nodeName.includes('button') || nodeName.includes('btn')) {
        return this.designSystemService.getComponent('Button', framework);
      }
      if (nodeName.includes('input') || nodeName.includes('field')) {
        return this.designSystemService.getComponent('Input', framework);
      }
      if (nodeName.includes('badge') || nodeName.includes('tag')) {
        return this.designSystemService.getComponent('Badge', framework);
      }
      break;
  }

  return null;  // nullì´ë©´ divë¡œ ì²˜ë¦¬
}

/**
 * FRAME ë…¸ë“œ ë¶„ì„ - ìì‹ êµ¬ì¡° ê¸°ë°˜ ì»´í¬ë„ŒíŠ¸ ì„ íƒ
 */
private analyzeFrameNode(
  node: FigmaNode,
  framework: 'react' | 'vue'
): DesignSystemComponent | null {
  const nodeName = node.name.toLowerCase();

  // ì´ë¦„ ê¸°ë°˜ ë§¤ì¹­
  if (nodeName.includes('tab') || nodeName.includes('tabs')) {
    return this.designSystemService.getComponent('Tab', framework);
  }
  if (nodeName.includes('accordion') || nodeName.includes('collapse')) {
    return this.designSystemService.getComponent('Accordion', framework);
  }
  if (nodeName.includes('modal') || nodeName.includes('dialog') || nodeName.includes('popup')) {
    return this.designSystemService.getComponent('Modal', framework);
  }

  // ìì‹ êµ¬ì¡° ë¶„ì„
  if (node.children && node.children.length > 0) {
    // ëª¨ë“  ìì‹ì´ TEXTì¸ ê²½ìš°
    const allTextChildren = node.children.every(child => child.type === 'TEXT');
    if (allTextChildren && node.children.length === 1) {
      return this.designSystemService.getComponent('Text', framework);
    }
    if (allTextChildren && node.children.length === 2) {
      return this.designSystemService.getComponent('LabeledText', framework);
    }

    // Tab ìì‹ì´ ìˆëŠ” ê²½ìš°
    const hasTabChildren = node.children.some(child =>
      child.name.toLowerCase().includes('tab')
    );
    if (hasTabChildren) {
      return this.designSystemService.getComponent('Tab', framework);
    }
  }

  return null;  // ì»¨í…Œì´ë„ˆ ì—­í• ë§Œ í•˜ë©´ divë¡œ ì²˜ë¦¬
}
```

### ì´ë¦„ ì •ê·œí™” ë§¤ì¹­

```typescript
// src/services/design-system.ts

findBestMatch(figmaComponentName: string, framework: 'react' | 'vue'): DesignSystemComponent | null {
  const components = framework === 'react' ? this.reactComponents : this.vueComponents;

  // ì •ê·œí™”: ssm- ì ‘ë‘ì‚¬ ì œê±°, í•˜ì´í”ˆ ì œê±°, ì†Œë¬¸ì ë³€í™˜
  const normalizeName = (name: string): string => {
    return name
      .toLowerCase()
      .replace(/^ssm-/, '')   // ssm- ì ‘ë‘ì‚¬ ì œê±°
      .replace(/^ssm/, '')    // ssm ì ‘ë‘ì‚¬ ì œê±°
      .replace(/-/g, '')      // í•˜ì´í”ˆ ì œê±°
      .trim();
  };

  const normalizedFigmaName = normalizeName(figmaComponentName);

  // ì§ì ‘ ë§¤ì¹­
  const directMatch = components.find(comp =>
    normalizeName(comp.name) === normalizedFigmaName
  );
  if (directMatch) return directMatch;

  // ë¶€ë¶„ ë§¤ì¹­
  for (const component of components) {
    const componentName = normalizeName(component.name);
    if (normalizedFigmaName.includes(componentName) ||
        componentName.includes(normalizedFigmaName)) {
      return component;
    }
  }

  // ì¼ë°˜ì ì¸ ë³€í˜• í™•ì¸
  const variations = [
    componentName + 's',  // ë³µìˆ˜í˜•
    componentName.replace('button', 'btn'),
    componentName.replace('modal', 'popup'),
    componentName.replace('modal', 'dialog'),
  ];
  // ...
}
```

### í•µì‹¬ êµí›ˆ

| ì „ëµ | ì„¤ëª… |
|------|------|
| ë‹¤ì¸µ ë§¤ì¹­ | ì´ë¦„ â†’ ë…¸ë“œ íƒ€ì… â†’ ìì‹ êµ¬ì¡° ìˆœìœ¼ë¡œ ë§¤ì¹­ ì‹œë„ |
| ì •ê·œí™” | ssm-, í•˜ì´í”ˆ ë“± ì œê±°í•˜ì—¬ ìœ ì—°í•œ ë§¤ì¹­ |
| í´ë°± | ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ div ì»¨í…Œì´ë„ˆë¡œ ì²˜ë¦¬ |
| ì»¨í…ìŠ¤íŠ¸ ë¶„ì„ | ë¶€ëª¨/ìì‹ ê´€ê³„ ë¶„ì„ìœ¼ë¡œ ì •í™•ë„ í–¥ìƒ |

---

## 6. ìºì‹œ ê¸°ë°˜ ì„±ëŠ¥ ìµœì í™”

### ë¬¸ì œ ìƒí™©

GitHub API í˜¸ì¶œì€ ë¹„ìš©ì´ ë†’ìŠµë‹ˆë‹¤:

- Rate Limit: ì¸ì¦ ì—†ì´ 60íšŒ/ì‹œê°„, ì¸ì¦ ì‹œ 5000íšŒ/ì‹œê°„
- ë„¤íŠ¸ì›Œí¬ ì§€ì—°: ê° íŒŒì¼ë‹¹ ë³„ë„ ìš”ì²­ í•„ìš”
- ì¤‘ë³µ í˜¸ì¶œ: ì„œë²„ ì¬ì‹œì‘ë§ˆë‹¤ ê°™ì€ ë°ì´í„° ë‹¤ì‹œ ê°€ì ¸ì˜´

**í•µì‹¬ ì§ˆë¬¸**: API í˜¸ì¶œì„ ìµœì†Œí™”í•˜ë©´ì„œ ìµœì‹  ë°ì´í„°ë¥¼ ìœ ì§€í•˜ë ¤ë©´?

### í•´ê²° ë°©ë²•: ì»¤ë°‹ SHA ê¸°ë°˜ ìºì‹œ ë¬´íš¨í™”

```typescript
// src/sync/cache-manager.ts

import { z } from 'zod';

// Zod ìŠ¤í‚¤ë§ˆë¡œ íƒ€ì… ì•ˆì „ì„± ë³´ì¥
const CacheMetadataSchema = z.object({
  version: z.string(),
  lastSyncedAt: z.string(),
  commitSha: z.string(),
  reactComponentCount: z.number(),
  vueComponentCount: z.number(),
});

export class CacheManager {
  private cacheDir: string;  // .cache/design-system

  /**
   * ìºì‹œê°€ ìœ íš¨í•œì§€ í™•ì¸ (ì»¤ë°‹ SHA + ë²„ì „ ë¹„êµ)
   */
  async isValid(currentCommitSha: string): Promise<boolean> {
    const metadata = await this.getMetadata();

    // ë²„ì „ ì²´í¬ (ìºì‹œ í˜•ì‹ ë³€ê²½ ëŒ€ì‘)
    if (metadata?.version !== CACHE_VERSION) {
      return false;
    }

    // ì»¤ë°‹ SHA ë¹„êµ (ì €ì¥ì†Œì— ë³€ê²½ì´ ìˆìœ¼ë©´ ë¬´íš¨)
    return metadata?.commitSha === currentCommitSha;
  }

  /**
   * ìºì‹œ ì €ì¥ (ì›ìì  ì“°ê¸°)
   */
  async save(
    commitSha: string,
    reactComponents: DesignSystemComponent[],
    vueComponents: DesignSystemComponent[]
  ): Promise<void> {
    await this.initialize();  // ë””ë ‰í† ë¦¬ ìƒì„±

    const metadata: CacheMetadata = {
      version: CACHE_VERSION,
      lastSyncedAt: new Date().toISOString(),
      commitSha,
      reactComponentCount: reactComponents.length,
      vueComponentCount: vueComponents.length,
    };

    // ë³‘ë ¬ ì €ì¥
    await Promise.all([
      writeFile(this.metadataFile, JSON.stringify(metadata, null, 2)),
      writeFile(this.reactCacheFile, JSON.stringify(reactComponents, null, 2)),
      writeFile(this.vueCacheFile, JSON.stringify(vueComponents, null, 2)),
    ]);
  }
}
```

### ë™ê¸°í™” ì„œë¹„ìŠ¤ì—ì„œì˜ í™œìš©

```typescript
// src/sync/component-sync.ts

async sync(options: SyncOptions = {}): Promise<SyncResult> {
  // 1. GitHubì—ì„œ ìµœì‹  ì»¤ë°‹ SHAë§Œ ê°€ì ¸ì˜´ (ê°€ë²¼ìš´ API í˜¸ì¶œ)
  const commitInfo = await this.githubClient.getLatestCommitSha();

  // 2. ìºì‹œ ìœ íš¨ì„± í™•ì¸
  if (!options.force) {
    const isValid = await this.cacheManager.isValid(commitInfo.sha);
    if (isValid) {
      // ìºì‹œê°€ ìœ íš¨í•˜ë©´ íŒŒì¼ì—ì„œ ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œ ì—†ìŒ!)
      const cached = await this.cacheManager.load();
      if (cached) {
        return {
          success: true,
          fromCache: true,  // ìºì‹œì—ì„œ ë¡œë“œë¨ì„ í‘œì‹œ
          reactComponents: cached.reactComponents,
          vueComponents: cached.vueComponents,
          commitSha: commitInfo.sha,
        };
      }
    }
  }

  // 3. ìºì‹œê°€ ë¬´íš¨í•˜ë©´ GitHubì—ì„œ ì „ì²´ ë™ê¸°í™”
  const [reactComponents, vueComponents] = await Promise.all([
    this.syncReactComponents(commitInfo.sha),
    this.syncVueComponents(commitInfo.sha),
  ]);

  // 4. ìƒˆ ë°ì´í„° ìºì‹œ ì €ì¥
  await this.cacheManager.save(commitInfo.sha, reactComponents, vueComponents);

  return { success: true, fromCache: false, ... };
}
```

### í•µì‹¬ êµí›ˆ

| ì›ì¹™ | ì ìš© |
|------|------|
| ìŠ¤ë§ˆíŠ¸ ë¬´íš¨í™” | ì»¤ë°‹ SHA ë¹„êµë¡œ ì‹¤ì œ ë³€ê²½ ì‹œì—ë§Œ ì¬ë™ê¸°í™” |
| ë²„ì „ ê´€ë¦¬ | ìºì‹œ í˜•ì‹ ë³€ê²½ ì‹œ ìë™ ë¬´íš¨í™” |
| í´ë°± ì§€ì› | GitHub ì ‘ê·¼ ë¶ˆê°€ ì‹œ ìºì‹œì—ì„œ ë¡œë“œ |
| ë³‘ë ¬ ì²˜ë¦¬ | íŒŒì¼ ì“°ê¸°/ì½ê¸° ë³‘ë ¬í™”ë¡œ I/O ìµœì í™” |
| íƒ€ì… ì•ˆì „ì„± | Zod ìŠ¤í‚¤ë§ˆë¡œ ìºì‹œ ë°ì´í„° ê²€ì¦ |

---

## ìš”ì•½: MCP ê°œë°œ í•µì‹¬ ì›ì¹™

ì´ í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ë„ì¶œëœ MCP ê°œë°œì˜ í•µì‹¬ ì›ì¹™ë“¤:

### 1. ë°ì´í„° ì ‘ê·¼ ì „ëµ

| ì›ì¹™ | ì„¤ëª… |
|------|------|
| **MCP-First + Fallback** | ë¡œì»¬ MCP ìš°ì„ , ì‹¤íŒ¨ ì‹œ API í´ë°± |
| **ìºì‹œ ê¸°ë°˜ ìµœì í™”** | ë³€ê²½ ê°ì§€ ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ ìºì‹œë¡œ API í˜¸ì¶œ ìµœì†Œí™” |
| **Lazy Loading** | ë¬´ê±°ìš´ ì˜ì¡´ì„±ì€ í•„ìš” ì‹œì ì— ë¡œë“œ |

### 2. ì™¸ë¶€ ì‹œìŠ¤í…œ í†µí•©

| ì›ì¹™ | ì„¤ëª… |
|------|------|
| **AST ë¶„ì„** | ìˆ˜ë™ ë©”íƒ€ë°ì´í„° ëŒ€ì‹  ì†ŒìŠ¤ ì½”ë“œ ìë™ ë¶„ì„ |
| **ë‹¤ì¤‘ íŒ¨í„´ ì§€ì›** | ë‹¤ì–‘í•œ ì½”ë”© ì»¨ë²¤ì…˜ ëª¨ë‘ ì§€ì› |
| **ì¬ê·€ì  íƒ€ì… í•´ê²°** | ë³µì¡í•œ íƒ€ì… ì°¸ì¡°ë„ ì™„ì „íˆ í•´ê²° |

### 3. í™˜ê²½ ëŒ€ì‘

| ì›ì¹™ | ì„¤ëª… |
|------|------|
| **ê³µí†µ ë¡œì§ ë¶„ë¦¬** | í™˜ê²½ë³„ ì§„ì…ì ê³¼ í•µì‹¬ ë¡œì§ ë¶„ë¦¬ |
| **ì„¤ì • ì£¼ì…** | í™˜ê²½ë³„ ì œì•½ì„ ì„¤ì •ìœ¼ë¡œ ì œì–´ |
| **ìš°ì•„í•œ ì„±ëŠ¥ ì €í•˜** | ê¸°ëŠ¥ ì¼ë¶€ ë¹„í™œì„±í™”ë¡œ ëª¨ë“  í™˜ê²½ ì§€ì› |

### 4. ë§¤í•‘ ë° ë³€í™˜

| ì›ì¹™ | ì„¤ëª… |
|------|------|
| **ë‹¤ì¸µ ë§¤ì¹­** | ì—¬ëŸ¬ ì „ëµì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹œë„ |
| **ì •ê·œí™”** | ì…ë ¥ ë°ì´í„° ì •ê·œí™”ë¡œ ë§¤ì¹­ ì„±ê³µë¥  í–¥ìƒ |
| **ì»¨í…ìŠ¤íŠ¸ ë¶„ì„** | ë¶€ëª¨/ìì‹ ê´€ê³„ ë¶„ì„ìœ¼ë¡œ ì •í™•ë„ í–¥ìƒ |

---

## Phase 1: ì ‘ê·¼ ì œì–´ - GitHub ì¡°ì§ ë©¤ë²„ì‹­ ì¸ì¦

### ë°°ê²½ ë° ëª©ì 

Palette MCPëŠ” npmê³¼ Smithery.aië¥¼ í†µí•´ ëˆ„êµ¬ë‚˜ ì„¤ì¹˜í•  ìˆ˜ ìˆì§€ë§Œ, ì‹¤ì œ ì„œë¹„ìŠ¤ ì´ìš©ì€ **dealicious-inc ì¡°ì§ ë©¤ë²„ë¡œ ì œí•œ**í•´ì•¼ í•©ë‹ˆë‹¤.

| ìš”êµ¬ì‚¬í•­ | ì„¤ëª… |
|----------|------|
| ì„¤ì¹˜ ê³µê°œ | npm/Smitheryì—ì„œ ëˆ„êµ¬ë‚˜ ì„¤ì¹˜ ê°€ëŠ¥ |
| ì‚¬ìš© ì œí•œ | dealicious-inc ì¡°ì§ ë©¤ë²„ë§Œ ë„êµ¬ ì‹¤í–‰ ê°€ëŠ¥ |
| ì¶”ê°€ ì¸í”„ë¼ ë¶ˆí•„ìš” | ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ GITHUB_TOKEN í™œìš© |

### êµ¬í˜„ ë°©ì‹

#### ì¸ì¦ í”Œë¡œìš°

```
ì‚¬ìš©ì ìš”ì²­ â†’ GITHUB_TOKEN í™•ì¸ â†’ GitHub API í˜¸ì¶œ â†’ ì¡°ì§ ë©¤ë²„ì‹­ í™•ì¸ â†’ í—ˆìš©/ê±°ë¶€
```

#### í•µì‹¬ íŒŒì¼

| íŒŒì¼ | ì—­í•  |
|------|------|
| `src/services/auth.ts` | ì¸ì¦ ì„œë¹„ìŠ¤ - ì¡°ì§ ë©¤ë²„ì‹­ í™•ì¸ ë¡œì§ |
| `src/server.ts` | ë„êµ¬ ì‹¤í–‰ ì „ ì¸ì¦ ê²€ì¦ í˜¸ì¶œ |

### ì¸ì¦ ì„œë¹„ìŠ¤ êµ¬í˜„ (`src/services/auth.ts`)

```typescript
// í—ˆìš©ëœ GitHub ì¡°ì§ ëª©ë¡
const ALLOWED_ORGANIZATIONS = ['dealicious-inc'];

// ì¸ì¦ ìƒíƒœ ìºì‹œ (1ì‹œê°„ ìœ íš¨)
const authCache = new Map<string, { valid: boolean; username: string; checkedAt: Date }>();

export async function validateAccess(githubToken?: string): Promise<AuthResult> {
  // 1. GITHUB_TOKEN í™•ì¸
  if (!githubToken) {
    return { authorized: false, error: 'GITHUB_TOKENì´ í•„ìš”í•©ë‹ˆë‹¤.' };
  }

  // 2. ìºì‹œ í™•ì¸ (ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ë°©ì§€)
  const cached = getCachedAuth(githubToken);
  if (cached) return cached;

  // 3. GitHub APIë¡œ ì¡°ì§ ë©¤ë²„ì‹­ í™•ì¸
  const octokit = new Octokit({ auth: githubToken });
  const isMember = await checkOrganizationMembership(octokit, 'dealicious-inc');

  // 4. ê²°ê³¼ ìºì‹œ ë° ë°˜í™˜
  setCachedAuth(githubToken, isMember, user.login);
  return { authorized: isMember, username: user.login };
}
```

### ì„œë²„ í†µí•© (`src/server.ts`)

```typescript
// ë„êµ¬ ì‹¤í–‰ ì „ ì¸ì¦ í™•ì¸
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  try {
    // ğŸ” ì¸ì¦ í™•ì¸
    await ensureAuthenticated();

    // ë„êµ¬ ì‹¤í–‰
    switch (name) {
      case 'convert_figma_to_react': ...
    }
  } catch (error) {
    return { content: [{ type: 'text', text: error.message }], isError: true };
  }
});
```

### ì¸ì¦ ê²°ê³¼ ì‹œë‚˜ë¦¬ì˜¤

| ìƒí™© | ê²°ê³¼ | ë©”ì‹œì§€ |
|------|------|--------|
| dealicious-inc ë©¤ë²„ | âœ… í—ˆìš© | ë„êµ¬ ì •ìƒ ì‹¤í–‰ |
| ì¡°ì§ ë©¤ë²„ ì•„ë‹˜ | âŒ ê±°ë¶€ | "ì‚¬ìš©ì 'xxx'ì€(ëŠ”) dealicious-inc ì¡°ì§ ë©¤ë²„ê°€ ì•„ë‹™ë‹ˆë‹¤" |
| GITHUB_TOKEN ì—†ìŒ | âŒ ê±°ë¶€ | "GITHUB_TOKENì´ í•„ìš”í•©ë‹ˆë‹¤" |
| í† í° ë§Œë£Œ/ë¬´íš¨ | âŒ ê±°ë¶€ | "GITHUB_TOKENì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤" |

### ë¡œì»¬ ê°œë°œ ì˜µì…˜

ê°œë°œ ë° í…ŒìŠ¤íŠ¸ ì‹œ ì¸ì¦ì„ ê±´ë„ˆë›¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```typescript
// ë¡œì»¬ ê°œë°œìš© - ì¸ì¦ ê±´ë„ˆë›°ê¸°
createPaletteServer({
  skipAuth: true,
});
```

### ì„±ëŠ¥ ìµœì í™”

| ìµœì í™” | ì„¤ëª… |
|--------|------|
| ìºì‹œ (1ì‹œê°„) | ë™ì¼ í† í°ì— ëŒ€í•´ ë°˜ë³µ API í˜¸ì¶œ ë°©ì§€ |
| ìµœì´ˆ 1íšŒ ê²€ì¦ | ì„¸ì…˜ ë‚´ ì²« ë„êµ¬ í˜¸ì¶œ ì‹œë§Œ ê²€ì¦ |
| ë¹„ë™ê¸° ì²˜ë¦¬ | ì„œë²„ ì´ˆê¸°í™” ì°¨ë‹¨ ì—†ìŒ |

### í–¥í›„ í™•ì¥ ê³„íš

| Phase | ê¸°ëŠ¥ | ì„¤ëª… |
|-------|------|------|
| Phase 1 (ì™„ë£Œ) | GitHub ì¡°ì§ ë©¤ë²„ì‹­ | dealicious-inc ë©¤ë²„ë§Œ í—ˆìš© |
| Phase 2 (ì˜ˆì •) | API Key ì‹œìŠ¤í…œ | ì™¸ë¶€ í˜‘ë ¥ì‚¬ ì§€ì›, ì„¸ë°€í•œ ê¶Œí•œ ì œì–´ |
| Phase 3 (ì˜ˆì •) | ì‚¬ìš©ëŸ‰ ì¶”ì  | ì‚¬ìš©ìë³„ í˜¸ì¶œ íšŸìˆ˜, ë¡œê·¸ ê¸°ë¡ |
